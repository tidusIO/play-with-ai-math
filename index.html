<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Monster Academy</title>
    <style>
      body {
        font-family: "Comic Sans MS", cursive;
        margin: 0;
        min-height: 100vh;
        background: url("https://img.freepik.com/free-vector/hand-drawn-monster-pattern_23-2149421352.jpg");
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .game-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 2rem;
        border-radius: 25px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 600px;
        border: 8px solid #ff6b6b;
      }

      .monster {
        font-size: 80px;
        margin: 10px;
        animation: bounce 1s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .problem {
        font-size: 32px;
        margin: 20px 0;
        color: #2d3436;
        background: #ffe66d;
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 4px 0 #ffc107;
      }

      .options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 20px 0;
      }

      .option {
        background: #4ecdc4;
        border: none;
        padding: 15px;
        border-radius: 15px;
        color: white;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 0 #45b7af;
        font-family: "Comic Sans MS", cursive;
      }

      .option:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 0 #45b7af;
      }

      .option:active {
        transform: translateY(2px);
        box-shadow: 0 2px 0 #45b7af;
      }

      .stats {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
        padding: 15px;
        background: #ff6b6b;
        border-radius: 15px;
        color: white;
        font-size: 20px;
      }

      .combo-meter {
        height: 20px;
        background: linear-gradient(90deg, #ff6b6b, #ffe66d);
        border-radius: 10px;
        margin-top: 15px;
        transition: width 0.3s;
      }

      .feedback {
        position: absolute;
        font-size: 40px;
        pointer-events: none;
        animation: flyUp 1s forwards;
        opacity: 0;
      }

      @keyframes flyUp {
        0% {
          transform: translateY(0);
          opacity: 1;
        }
        100% {
          transform: translateY(-100px);
          opacity: 0;
        }
      }

      .monster-container {
        position: relative;
        height: 100px;
      }

      .monster-emotion {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        text-align: center;
      }

      .difficulty-select {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      .difficulty-btn {
        background: #ff6b6b;
        border: none;
        padding: 15px 30px;
        border-radius: 15px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 0 #ff5252;
        font-family: "Comic Sans MS", cursive;
      }

      .difficulty-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 0 #ff5252;
      }

      .timer {
        background: #ff6b6b;
        color: white;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 15px;
        font-size: 20px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="difficulty-select">
        <button class="difficulty-btn" onclick="startGame('easy')">
          Easy Mode
        </button>
        <button class="difficulty-btn" onclick="startGame('hard')">
          Hard Mode
        </button>
      </div>
      <div class="timer" id="timer">Time: <span id="timeLeft">15</span>s</div>
      <div class="monster-container">
        <div class="monster" id="monster">ü¶ñ</div>
      </div>
      <h2>Math Monster Academy</h2>
      <div class="problem" id="problem"></div>
      <div class="options" id="options"></div>
      <div class="stats">
        <div>Correct: <span id="score">0</span>/10 ‚úÖ</div>
        <div>Lives: <span id="lives">3</span>‚ù§Ô∏è</div>
      </div>
      <div class="combo-meter" id="comboMeter"></div>
    </div>

    <div class="modal" id="gameModal">
      <div class="modal-content">
        <h2 id="modalTitle"></h2>
        <p id="modalMessage"></p>
        <button class="option" onclick="resetGame()">Play Again</button>
      </div>
    </div>

    <script>
      let score = 0;
      let lives = 3;
      let currentProblem = {};
      let gameMode = "";
      let timerInterval;
      const monsters = ["ü¶ñ", "ü¶ï", "üëæ", "üëª", "üê≤", "üêâ", "ü¶î", "üêô"];
      const reactions = ["‚ú®", "üéâ", "üåü", "üí´", "‚≠ê", "üéà"];

      const operations = [
        { symbol: "+", operation: (a, b) => a + b },
        { symbol: "-", operation: (a, b) => a - b },
        { symbol: "√ó", operation: (a, b) => a * b },
        { symbol: "√∑", operation: (a, b) => a / b },
      ];

      function showModal(title, message) {
        document.getElementById("modalTitle").textContent = title;
        document.getElementById("modalMessage").textContent = message;
        document.getElementById("gameModal").style.display = "flex";
      }

      function showFeedback(correct) {
        const feedback = document.createElement("div");
        feedback.className = "feedback";
        feedback.style.position = "absolute";
        feedback.style.left = `${Math.random() * 80 + 10}%`;
        feedback.style.top = `${Math.random() * 50 + 25}%`;

        if (correct) {
          feedback.textContent =
            reactions[Math.floor(Math.random() * reactions.length)];
          new Audio(
            "https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"
          )
            .play()
            .catch(() => {});
        } else {
          feedback.textContent = "‚ùå";
          new Audio(
            "https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"
          )
            .play()
            .catch(() => {});
        }

        document.body.appendChild(feedback);
        setTimeout(() => feedback.remove(), 1000);
      }

      function generateProblem() {
        if (gameMode === "easy") {
          // Easy mode: smaller numbers, only addition and subtraction
          const operation = operations[Math.floor(Math.random() * 2)]; // Only + and -
          const a = Math.floor(Math.random() * 10) + 1;
          const b = Math.floor(Math.random() * 10) + 1;

          if (operation.symbol === "-" && b > a) {
            [a, b] = [b, a];
          }

          const result = operation.operation(a, b);
          return {
            question: `${a} ${operation.symbol} ${b}`,
            answer: result,
            options: generateOptions(result),
          };
        } else {
          // Hard mode: Complex calculations with 3-5 numbers
          const numCount = Math.floor(Math.random() * 3) + 3; // 3 to 5 numbers
          let numbers = [];
          let operations = [];
          let question = "";

          // Generate numbers and operations
          for (let i = 0; i < numCount; i++) {
            if (i > 0) {
              const op = ["√ó", "√∑", "+", "-"][Math.floor(Math.random() * 4)];
              operations.push(op);
            }

            let num;
            if (i < numCount - 1) {
              num = Math.floor(Math.random() * 12) + 1;
            } else {
              // Make sure last number creates whole number for division
              const prevNum = numbers[numbers.length - 1];
              num =
                operations[operations.length - 1] === "√∑"
                  ? [1, 2, 3, 4, 6, prevNum][Math.floor(Math.random() * 6)]
                  : Math.floor(Math.random() * 12) + 1;
            }
            numbers.push(num);
          }

          // Build question string and calculate result
          question = numbers[0].toString();
          let result = numbers[0];

          for (let i = 1; i < numbers.length; i++) {
            question += ` ${operations[i - 1]} ${numbers[i]}`;
            switch (operations[i - 1]) {
              case "+":
                result += numbers[i];
                break;
              case "-":
                result -= numbers[i];
                break;
              case "√ó":
                result *= numbers[i];
                break;
              case "√∑":
                result /= numbers[i];
                break;
            }
          }

          return {
            question: question,
            answer: Math.round(result * 100) / 100, // Round to 2 decimal places
            options: generateOptions(result),
          };
        }
      }

      function generateOptions(answer) {
        const options = [answer];
        while (options.length < 4) {
          let offset;
          if (gameMode === "hard") {
            // Larger offsets for hard mode
            offset = Math.floor(answer * (Math.random() * 0.5 + 0.1));
            if (offset === 0) offset = Math.floor(Math.random() * 5) + 1;
          } else {
            offset = Math.floor(Math.random() * 5) + 1;
          }

          const option = answer + (Math.random() < 0.5 ? offset : -offset);
          if (!options.includes(option) && option >= 0) {
            options.push(option);
          }
        }
        return options.sort(() => Math.random() - 0.5);
      }

      function updateUI() {
        document.getElementById("problem").textContent =
          currentProblem.question;
        const optionsContainer = document.getElementById("options");
        optionsContainer.innerHTML = "";

        currentProblem.options.forEach((option) => {
          const button = document.createElement("button");
          button.className = "option";
          button.textContent = option;
          button.onclick = () => checkAnswer(option);
          optionsContainer.appendChild(button);
        });

        document.getElementById("score").textContent = score;
        document.getElementById("lives").textContent = lives;
        document.getElementById("monster").textContent =
          monsters[Math.floor(Math.random() * monsters.length)];
      }

      function startTimer() {
        let timeLeft = 15;
        document.getElementById("timeLeft").textContent = timeLeft;

        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeLeft--;
          document.getElementById("timeLeft").textContent = timeLeft;

          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            lives--;
            showFeedback(false);

            if (lives === 0) {
              showModal(
                "Game Over üò¢",
                `Time's up! You got ${score} questions correct.`
              );
              return;
            }

            currentProblem = generateProblem();
            updateUI();
            if (gameMode === "hard") startTimer();
          }
        }, 1000);
      }

      function startGame(mode) {
        gameMode = mode;
        document.querySelector(".difficulty-select").style.display = "none";
        document.getElementById("timer").style.display =
          gameMode === "hard" ? "block" : "none";
        resetGame();
      }

      function checkAnswer(selectedAnswer) {
        clearInterval(timerInterval);

        if (Math.abs(selectedAnswer - currentProblem.answer) < 0.01) {
          score++;
          showFeedback(true);

          if (score === 10) {
            showModal(
              "Congratulations! üéâ",
              "You won the game! You answered all 10 questions correctly!"
            );
            return;
          }
        } else {
          lives--;
          showFeedback(false);

          if (lives === 0) {
            showModal(
              "Game Over üò¢",
              `You ran out of lives! You got ${score} questions correct.`
            );
            return;
          }
        }

        currentProblem = generateProblem();
        updateUI();
        if (gameMode === "hard") startTimer();
      }

      function resetGame() {
        score = 0;
        lives = 3;
        document.getElementById("gameModal").style.display = "none";
        currentProblem = generateProblem();
        updateUI();
        if (gameMode === "hard") startTimer();
      }

      // Don't auto-start the game anymore
      document.querySelector(".difficulty-select").style.display = "flex";
    </script>
  </body>
</html>
